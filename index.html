<!DOCTYPE html>
<html lang="sv">
<head>
  <!-- ============== 1) BAS & SEO ============== -->
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Queer Journal</title>
  <meta name="description" content="Queer Journal ‚Äì privat dagbok + community. HBTQ+ och NPF-v√§nligt.">
  <link rel="canonical" href="https://robynt98.github.io/queerjournal/">

  <!-- Open Graph -->
  <meta property="og:title" content="Queer Journal">
  <meta property="og:description" content="Privat dagbok + community i din webbl√§sare.">
  <meta property="og:image" content="https://robynt98.github.io/queerjournal/android-chrome-512x512.png">
  <meta property="og:type" content="website">

  <!-- ============== 2) PWA / IKONER ============== -->
  <link rel="manifest" href="./manifest.webmanifest" />
  <meta name="theme-color" content="#d53369" />
  <link rel="apple-touch-icon" href="./apple-touch-icon.png" />
  <link rel="icon" sizes="32x32" href="./favicon-32x32.png" />
  <link rel="icon" sizes="16x16" href="./favicon-16x16.png" />

  <!-- ============== 3) TYPSNITT & STIL ============== -->
  <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600&display=swap">
  <link rel="stylesheet" href="./styles.css">

  <!-- Sm√• f√∂rb√§ttringar f√∂r iOS standalone -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <!-- ============== 3.5) Minimal footer-fix s√• inget √∂verlappar ============== -->
  <style>
    /* G√∂r footern tydlig och s√§ker */
    footer {
      position: fixed; /* sticky footer */
      left: 0; right: 0; bottom: 0;
      z-index: 999;
      background: var(--card, #111);
      border-top: 1px solid var(--line, #333);
      padding: .6rem .8rem;
    }
    footer .tabs {
      display: grid;
      grid-auto-flow: column;
      gap: .4rem;
      margin-bottom: .35rem;
    }
    footer p {
      margin: .15rem 0 0;
      text-align: center;
      font-size: .85rem;
      opacity: .85;
    }
    /* S√§kerst√§ll att inneh√•ll inte d√∂ljs (script justerar ocks√•) */
    main { display:block; }
    header { position: relative; z-index: 1; }
    /* B√§ttre klick/kontrast f√∂r l√§nkar i footer */
    footer a { color: inherit; text-decoration: underline; }
    /* Knappar i header som inte √§r i formul√§r */
    button { cursor: pointer; }
  </style>
</head>
<body>
  <noscript>Den h√§r appen kr√§ver JavaScript f√∂r att fungera.</noscript>

  <script>
    /* Rensa ev. gammalt PIN-l√•s fr√•n √§ldre versioner */
    try { ['qj.pin','qj.salt','qj.attempts'].forEach(k => localStorage.removeItem(k)); } catch {}
  </script>

  <!-- ============== 4) HEADER ============== -->
  <header role="banner">
    <h1>üåà Queer Journal</h1>
    <div class="actions" role="group" aria-label="Snabb√•tg√§rder">
      <div class="user-chip" id="userChip" style="display:none">
        <img id="userPhoto" alt="" loading="lazy">
        <small id="userName"></small>
      </div>
      <button type="button" id="editProfileBtn" class="toggle-dark" title="Redigera profil" style="display:none">üë§</button>
      <button type="button" id="logoutTop" class="toggle-dark" title="Logga ut" style="display:none">üö™</button>
      <button type="button" id="darkToggle" class="toggle-dark" title="Byt tema">üåì</button>
    </div>
  </header>

  <!-- ============== 5) HUVUDINNEH√ÖLL ============== -->
  <main role="main">
    <!-- 5.1 AUTH -->
    <section id="authSection" class="card" aria-labelledby="authTitle">
      <h2 id="authTitle">Logga in / Skapa konto</h2>
      <input id="emailInput" type="email" autocomplete="username" placeholder="E-post" />
      <input id="passwordInput" type="password" autocomplete="current-password" placeholder="L√∂senord" />
      <div class="row">
        <button type="button" id="resetBtn" class="pill secondary">Gl√∂mt l√∂senord</button>
        <button type="button" id="loginBtn" class="pill">Logga in</button>
        <button type="button" id="registerBtn" class="pill secondary">Skapa konto</button>
        <button type="button" id="googleBtn" class="pill gbtn" aria-label="Logga in med Google">
          <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="" aria-hidden="true"> Google
        </button>
        <button type="button" id="logoutBtn" class="pill" style="display:none">Logga ut</button>
      </div>
    </section>

    <!-- 5.2 NY ANTECKNING -->
    <section id="noteSection" class="card" style="display:none" aria-labelledby="newNoteTitle">
      <h2 id="newNoteTitle">Ny anteckning</h2>

      <div class="row">
        <label style="flex:1">Datum
          <input id="dateInput" type="date" />
        </label>
        <label style="flex:1">Tid
          <input id="timeInput" type="time" />
        </label>
      </div>

      <label><input id="alarmCheck" type="checkbox" /> ‚è∞ St√§ll alarm</label>

      <div class="row">
        <label style="flex:1">K√§nsla
          <select id="moodInput">
            <option value="">--</option>
            <option>üòä Glad</option>
            <option>üî• Taggad</option>
            <option>üò¢ Ledsen</option>
            <option>üåà Stolt</option>
          </select>
        </label>

        <label style="flex:1">Taggar
          <input id="tagsInput" type="text" placeholder="t.ex. skola, katt" />
        </label>
      </div>

      <label>Inneh√•ll
        <textarea id="contentInput" placeholder="t.ex. 1/2 p√•se bl√∂tmat"></textarea>
      </label>

      <div class="row" style="align-items:center">
        <label style="flex:1">Bild (valfritt)
          <input id="imageInput" type="file" accept="image/*" />
        </label>

        <!-- Delning till community -->
        <label style="display:inline-flex; align-items:center; gap:.5rem; margin-top:.5rem">
          <input id="publicCheck" type="checkbox">
          üåç Dela i community
        </label>
      </div>

      <div class="row" style="margin-top:.6rem">
        <button type="button" id="saveBtn" class="pill">Spara</button>
        <button type="button" id="clearBtn" class="pill secondary">Rensa</button>
      </div>
    </section>

    <!-- 5.3 MINA ANTECKNINGAR -->
    <section id="notesSection" class="card" style="display:none" aria-labelledby="myNotesTitle">
      <h2 id="myNotesTitle">Mina anteckningar</h2>
      <div id="notesList" class="empty">Inga anteckningar √§nnu.</div>
    </section>

    <!-- 5.4 COMMUNITY -->
    <section id="communitySection" class="card" style="display:none" aria-labelledby="communityTitle">
      <h2 id="communityTitle">Community</h2>

      <!-- S√∂kf√§lt (matchar app.js: communitySearchInput / communitySearchBtn / communitySearchResults) -->
      <div class="row" style="margin-bottom:.5rem">
        <input id="communitySearchInput" type="text" placeholder="S√∂k: text, #tagg eller namn" aria-label="S√∂k i community">
        <button type="button" id="communitySearchBtn" class="pill secondary">S√∂k</button>
        <div id="communitySearchResults" class="muted" style="align-self:center" aria-live="polite"></div>
      </div>

      <div id="communityList" class="empty">Inga delade inl√§gg √§nnu.</div>
    </section>

    <!-- 5.5 MIN PROFIL ‚Äì REDIGERA -->
    <section id="profileEditSection" class="card" style="display:none;max-width:920px;margin-inline:auto" aria-labelledby="myProfileTitle">
      <h2 id="myProfileTitle">Min profil</h2>
      <div class="row">
        <label style="flex:1">Visningsnamn
          <input id="profDisplayName" type="text" placeholder="Ditt namn / smeknamn">
        </label>
        <label style="flex:1">Pronomen
          <input id="profPronouns" type="text" placeholder="t.ex. hen / hon / han / they">
        </label>
      </div>
      <label>Om mig
        <textarea id="profBio" placeholder="Kort bio"></textarea>
      </label>
      <label>Intressen / taggar (komma-separerat)
        <input id="profTags" type="text" placeholder="t.ex. skola, katt, spel">
      </label>
      <div class="row" style="margin-top:.6rem">
        <button type="button" id="saveProfileBtn" class="pill">Spara profil</button>
        <button type="button" id="cancelProfileBtn" class="pill secondary">St√§ng</button>
      </div>
    </section>

    <!-- 5.6 ANNANS PROFIL ‚Äì VISNING (DM-panel skapas dynamiskt av app.js) -->
    <section id="profileViewSection" class="card" style="display:none;max-width:920px;margin-inline:auto" aria-labelledby="otherProfileTitle">
      <h2 id="otherProfileTitle" style="display:none">Profil</h2>
      <div id="profileViewHeader" class="row" style="align-items:center;gap:.75rem"></div>
      <div id="profileViewMeta" class="muted" style="margin:.25rem 0 .75rem"></div>
      <h3>Publika inl√§gg</h3>
      <div id="profileViewPosts" class="empty">Inga publika inl√§gg √§nnu.</div>
      <div class="row" style="margin-top:.6rem">
        <button type="button" id="closeProfileViewBtn" class="pill secondary">St√§ng</button>
      </div>
    </section>
  </main>

  <!-- ============== 6) FOOTER & NAV ============== -->
  <footer role="contentinfo">
    <div class="tabs" role="tablist" aria-label="Huvudnavigation">
      <button type="button" id="listViewBtn"  class="tab active" role="tab" aria-selected="true">Lista</button>
      <button type="button" id="dayViewBtn"   class="tab" role="tab" aria-selected="false">Dag</button>
      <button type="button" id="weekViewBtn"  class="tab" role="tab" aria-selected="false">Vecka</button>
      <button type="button" id="alarmViewBtn" class="tab" role="tab" aria-selected="false">Alarm</button>
      <button type="button" id="communityViewBtn" class="tab" role="tab" aria-selected="false">Community</button>
    </div>
    <p>
      <a href="TERMS.md">Anv√§ndarvillkor</a> ¬∑
      <a href="PRIVACY.md">Integritetspolicy</a> ¬∑
      <a href="COOKIES.md">Cookiepolicy</a>
    </p>
    <p id="copyrightLine">¬© 2025 Queer Journal</p>
  </footer>

  <!-- ============== 7) LJUDFILER (ALARM) ============== -->
  <audio id="alarmSound" src="https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg" preload="auto"></audio>

  <!-- ============== 8) HUVUDSCRIPT ============== -->
  <script type="module" src="./app.js"></script>

  <!-- ============== 9) COOKIE-BANNER ============== -->
  <div id="cookie-banner"
       style="position:fixed;bottom:0;left:0;right:0;background:#222;color:#fff;
              padding:10px;text-align:center;display:none;z-index:10000">
    Vi anv√§nder cookies f√∂r att f√∂rb√§ttra din upplevelse.
    <a href="COOKIES.md" style="color:#4ecdc4">L√§s mer</a>
    <button type="button" onclick="acceptCookies()" style="margin-left:10px">OK</button>
  </div>
  <script>
    function acceptCookies(){
      localStorage.setItem("cookiesAccepted","true");
      document.getElementById("cookie-banner").style.display="none";
    }
    window.addEventListener("load", ()=>{
      if(!localStorage.getItem("cookiesAccepted")){
        document.getElementById("cookie-banner").style.display="block";
      }
    });
  </script>

  <!-- ============== 10) FOOTER-SPACER FIX (s√• inget hamnar bakom) ============== -->
  <script>
    function adjustFooterSpace(){
      const f = document.querySelector('footer');
      const h = f ? f.offsetHeight : 0;
      // L√§gg spacing b√•de p√• <body> och <main> f√∂r s√§kerhets skull
      document.body.style.paddingBottom = (h + 12) + 'px';
      const main = document.querySelector('main');
      if(main) main.style.paddingBottom = (h + 12) + 'px';
    }
    window.addEventListener('load', adjustFooterSpace);
    window.addEventListener('resize', adjustFooterSpace);
    // k√∂r √§ven efter dynamiska visningar (t.ex. n√§r profilsidor √∂ppnas)
    const ro = new ResizeObserver(adjustFooterSpace);
    ro.observe(document.body);
  </script>
</body>
</html>
