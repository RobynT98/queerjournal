<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Queer Journal</title>
  <link rel="manifest" href="manifest.webmanifest">
  <style>
    body { font-family: sans-serif; margin: 1rem; }
    .pill { padding: .5rem 1rem; margin: .2rem; border-radius: 15px; border: 1px solid #333; }
    .danger { background: red; color: white; }
    .row { display: flex; gap: .5rem; flex-wrap: wrap; }
  </style>
</head>
<body>
  <header>
    <h1>üåà Queer Journal</h1>
    <p>Schema ‚Ä¢ Memo ‚Ä¢ Dagbok ‚Äì offline & privat</p>
  </header>

  <main>
    <section>
      <h2>Ny anteckning</h2>
      <label>Datum <input id="date" type="date"></label>
      <label>Tid <input id="time" type="time"></label>
      <label><input id="setAlarm" type="checkbox"> ‚è∞ St√§ll alarm</label>
      <br>
      <label>K√§nsla <select id="feeling">
        <option value="">‚Äì</option>
        <option>Glad</option>
        <option>Ledsen</option>
        <option>Stolt</option>
      </select></label>
      <label>Taggar <input id="tags" type="text"></label>
      <br>
      <textarea id="content" placeholder="t.ex. 1/2 p√•se bl√∂tmat" rows="4" cols="30"></textarea>
      <br>
      <label>Bild (valfritt) <input id="image" type="file" accept="image/*"></label>
      <br>
      <button id="saveBtn" class="pill">Spara</button>
      <button id="clearBtn" class="pill">Rensa</button>
    </section>

    <section>
      <h2>Filter</h2>
      <input id="searchText" type="text" placeholder="s√∂k text">
      <input id="tagFilter" type="text" placeholder="filtrera p√• tagg">
      <br>
      <button id="exportBtn" class="pill">Exportera</button>
      <button id="importBtn" class="pill">Importera</button>
      <input id="fileInput" type="file" accept=".json" style="display:none">
    </section>

    <section>
      <h2>Mina anteckningar</h2>
      <div id="entries"></div>
    </section>
  </main>

  <footer>
    <div class="row">
      <button id="listViewBtn" class="pill">Lista</button>
      <button id="dayViewBtn" class="pill">Dag</button>
      <button id="weekViewBtn" class="pill">Vecka</button>
      <button id="alarmViewBtn" class="pill">Alarm</button>
    </div>
  </footer>

  <!-- Alarm-ljud -->
  <audio id="alarmSound" src="https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg" preload="auto"></audio>

<script>
let state = { entries: [] };
let viewMode = "list";

// Be om tillst√•nd f√∂r notiser
if ("Notification" in window && Notification.permission !== "granted") {
  Notification.requestPermission();
}

function save() {
  localStorage.setItem("entries", JSON.stringify(state.entries));
}

function load() {
  const saved = localStorage.getItem("entries");
  if (saved) state.entries = JSON.parse(saved);
}

function render() {
  const container = document.getElementById("entries");
  container.innerHTML = "";
  if (state.entries.length === 0) {
    container.textContent = "Inga anteckningar.";
    return;
  }
  state.entries.forEach((note, idx) => {
    const div = document.createElement("div");
    div.style.border = "1px solid #ccc";
    div.style.margin = ".5rem 0";
    div.style.padding = ".5rem";
    div.innerHTML = `
      <strong>${note.feeling || "üåà"} ‚Äì ${note.tags || ""}</strong>
      <br>${note.date} ${note.time} ${note.alarm ? "‚è∞" : ""}
      <p>${note.content}</p>
      <button onclick="deleteEntry(${idx})" class="pill danger">Radera</button>
    `;
    container.appendChild(div);
  });
}

function deleteEntry(idx) {
  state.entries.splice(idx, 1);
  save();
  render();
}

function triggerAlarm(note) {
  // 1. spela ljud
  const sound = document.getElementById("alarmSound");
  if (sound) {
    sound.play().catch(err => console.log("Kan inte spela ljud:", err));
  }
  // 2. systemnotis
  if ("Notification" in window && Notification.permission === "granted") {
    new Notification("‚è∞ Alarm!", {
      body: note.content || "Dags att kolla din anteckning!",
      icon: "icons/icon-192.png"
    });
  } else {
    alert("‚è∞ " + (note.content || "Alarm!"));
  }
}

document.getElementById("saveBtn").onclick = () => {
  const note = {
    date: document.getElementById("date").value,
    time: document.getElementById("time").value,
    alarm: document.getElementById("setAlarm").checked,
    feeling: document.getElementById("feeling").value,
    tags: document.getElementById("tags").value,
    content: document.getElementById("content").value
  };
  state.entries.push(note);
  save();
  render();

  // Om alarm √§r satt
  if (note.alarm && note.date && note.time) {
    const now = new Date().getTime();
    const alarmTime = new Date(note.date + "T" + note.time).getTime();
    const delay = alarmTime - now;
    if (delay > 0) {
      setTimeout(() => triggerAlarm(note), delay);
    }
  }
};

document.getElementById("clearBtn").onclick = () => {
  document.getElementById("content").value = "";
  document.getElementById("tags").value = "";
};

load();
render();
</script>
</body>
                                                                              </html>
